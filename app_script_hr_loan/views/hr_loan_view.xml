<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <record model="ir.ui.view" id="app_script_hr_loan_type_form_view">
            <field name="name">hr.loan.type.form</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <form string="Loans Types">
                    <field name="active" invisible="1"/>
                    <sheet>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
                        <widget name="web_ribbon" title="Active" bg_color="bg-info" invisible="not active"/>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="code"/>
                            </group>
                            <group>
                                <field name="company_id" force_save="1"/>
                                <field name="start_date"/>
                                <field name="end_date"/>
                            </group>
                        </group>
                        <group>
                            <field name="loan_purpose"/>
                        </group>
                        <notebook colspan="4">
                            <page string="Definition" >
                                <group >
                                    <group>
                                        <field name="loan_type"/>
                                        <field name="loan_amount" invisible="loan_type != 'fixed'"/>
                                        <field name="installment"/>
                                        <field name="max_loan_amount" invisible="loan_type != 'salary'"  required="loan_type == 'salary'"/>
                                        <field name="decimal_calculate"/>
                                    </group>
                                </group>
                                <separator string="Description"/>
                                <field name="note"/>
                            </page>
                            <page string="Salary Configrations" invisible="loan == 'fixed'">
                                <group>
                                    <field name="salary_rule_ids" widget="many2many_tags" required="loan_type == 'salary'"/>
                                    <field name="factor" required="loan_type == 'salary'"/>
                                </group>
                            </page>
                            <page string="Terms and Conditions">
                                <group>
                                    <group>
                                        <field name="request_by_employee"/>
                                        <field name="loan_limit" />
                                        <label for="limit" invisible="loan_limit != 'limit'" required="loan_type == 'limit'"/>
                                        <div class="o_row" name="limit" invisible="loan_limit != 'limit'" required="loan_type == 'limit'">
                                            <field name="limit" nolabel="1"/>
                                            <span>In Service</span>
                                        </div>
                                        <field name="month_no" invisible="loan_limit == 'one'"/>
                                        <field name="interference" invisible="loan_limit == 'one'"/>
                                        <!--field name="violation"/-->
                                        <field name="year_employment"/>
                                        
                                    </group>
                                    <group>
                                        <field name="validation"/>
                                        <field name="need_evaluate_performance"/>
                                        <field name="evaluate_degree" invisible="not need_evaluate_performance" required="need_evaluate_performance"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Structures">
                                <group>
                                    <group>
                                        <field name="company_id" invisible="1"/>
                                        <field name="structure_type_ids"  widget="many2many_tags" options="{'no_create': True , 'no_edit': True}"/>
                                        <field name="emp_tag_ids" widget="many2many_tags" options="{'no_create': True , 'no_edit': True}"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Suspend Configrations">
                                <group>
                                    <label for="times_stop_loan"/>
                                    <div class="o_row" name="times_stop_loan">
                                       <field name="times_stop_loan" nolabel="1"/>
                                    </div>
                                    <label for="period_stop_loan"/>
                                    <div class="o_row" name="period_stop_loan">
                                       <field name="period_stop_loan" nolabel="1"/>
                                       <span>Months</span>
                                    </div>
                                </group>
                            </page>
                            <page string="Accounts Configrations">
                                <group>
                                    <field name="loan_account_id" />
                                    <field name="loan_journal_id" domain="[('type','in',('cash','bank'))]"/>
                                </group>
                            </page>
	                    </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_loan_type_tree" model="ir.ui.view">
            <field name="name">hr.loan.type.tree</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <tree string="Loans Types" decoration-muted="(not active)">
		            <field name="code" />
                    <field name="name"/>
		            <field name="active" widget="boolean_toggle"/>
                </tree>
            </field>
        </record>

        <record id="view_loan_type_search" model="ir.ui.view">
            <field name="name">hr.loan.type.search</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <search string="Loans Types">
                    <field name="name" string="Loan Name"/>
                    <filter name="active" string="Active" domain="[('active','=',True)]" help="Show active loans"/>
                    <filter name="inactive" string="Inactive" domain="[('active','=',False)]" help="Show inactive loans"/>
                </search>
            </field>
        </record>

        <record id="app_script_hr_loan_action" model="ir.actions.act_window">
            <field name="name">Loans Types</field>
            <field name="res_model">hr.loan.type</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_loan_type_search"/>
            <field name="context">{'active_test': False, 'search_default_active': 1}</field>
        </record>

        <menuitem
            name="Loans"
            id="menu_app_script_hr_loan_root"
            parent="hr.menu_hr_root"
            groups="hr_payroll.group_hr_payroll_user"/>

        <menuitem
            name="Configration"
            id="menu_app_script_hr_loan_configration"
            parent="menu_app_script_hr_loan_root"
            sequence="95"
            groups="app_script_hr_loan.group_loan_read,app_script_hr_loan.group_loan_configration"/>

        <menuitem
            id="menu_app_script_hr_loan_type"
            action="app_script_hr_loan_action"
            parent="menu_app_script_hr_loan_configration"
            sequence="2"/>

        <record id="app_script_hr_loan_tree_view" model="ir.ui.view">
            <field name="name">hr.loan.tree</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <tree string="Loans Requests">
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="loan_id"/>
                    <field name="employee_counts" invisible="1"/>
                    <field name="loan_amount"/>
                    <field name="installment"/>
                    <field name="total_paid_amount"/>
                    <field name="remain_amount"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="app_script_hr_loan_form_view" model="ir.ui.view">
            <field name="name">hr.loan.form</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <form string="Loans Requests">
                    <header>
                        <button name="action_request" type="object" string="Request" invisible="state != 'draft'" class="oe_highlight" groups="app_script_hr_loan.group_request_loan"/>
                        <button name="action_approve" type="object" string="Approve" invisible="state != 'requested'" class="oe_highlight" groups="app_script_hr_loan.group_approve_loan"/>
                        <button name="action_double_approve" type="object" string="Approve" invisible="stats != 'approved2" class="oe_highlight" groups="app_script_hr_loan.group_secound_approve_loan"/>
                        <button name="action_transfer" type="object" string="Transfer To Accounting" invisible="state != 'approved'" class="oe_highlight" groups="app_script_hr_loan.group_transfer_to_accounting_loan"/>

                        <button name="action_payment" type="object" string="Payment" invisible="state != 'transfered'" class="oe_highlight" groups="app_script_hr_loan.group_payment_loan"/>

                        <button name="action_draft" type="object" string="Set to Draft" invisible="state not in ['rejected', 'approved']" groups="app_script_hr_loan.group_set_to_draft_loan"/>
                        <button name="action_refuse" type="object" string="Refuse" invisible="state not in ['confirm', 'requested', 'approved2']" groups="app_script_hr_loan.group_refuse_loan"/>

                        <button name="action_done" type="object" string="Complete" invisible="state != 'paid'" groups="app_script_hr_loan.group_payment_loan" class="oe_highlight"/>

                        <field name="state" widget="statusbar" statusbar_visible="draft,requested,approved,transfered,paid,done" />
                    </header>
                    <field name="active" invisible="1"/>
                    <sheet>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" 
                                name="restructuring_loan"
                                string="Restructuring" type="object"
                                groups="app_script_hr_loan.group_loan_restructure" invisible="state != 'paid'"
                                icon="fa-pencil-square-o"/>
                        </div>
                       
                        <group string="Employee Information" col="4">
                            <field name="employee_id" force_save="1"/>
                            <field name="contract_id" force_save="1"/>
                            <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                            <field name="department_id"/>
                        </group>
                        <group>
                            <group string="Loan Information">
                                <field name="name" force_save="1"/>
                                <field name="loan_id" domain="[('request_by_employee','=',True)]" force_save="1"/>
                                <field name="date" readonly="state in ['transfered', 'paid', 'done', 'rejected']"/>
                                <field name="payment_date" readonly="state in ['transfered', 'paid', 'done', 'rejected']"/>
                                <field name="salary_amount" invisible="1"/>
                            </group>
                            <group string="Loan Purpose">
                                <field name="loan_purpose" readonly='1' />
                                <field name="employee_counts" invisible='1'/>
                                <field name="move_id" readonly='1' />
                            </group>
                        </group>
                        <group string="Reject Reason" readonly="1" invisible="state != 'rejected'">
                            <field name="reject_reason" />
                        </group>
                        <notebook>
                            <page string="Installments">
                                <group col="4">
                                    <group>
                                        <field name="max_ins_num" readonly="1" force_save="1"/>
                                    </group>
                                    <group>
                                        <field name="max_loan_amount" readonly="1" force_save="1"/>
                                    </group>
                                </group>
                                <group col="8">
                                    <div  class="oe_inline" name="edit_alias" style="display: inline;">
                                    <span>(</span> No Of Installments <field name="installment" string="No Of Installments" class="oe_inline" readonly="state in ['transfered', 'paid', 'done', 'rejected']"/>
                                    * Installment Amount
                                    <field name="installment_amount" string="Installment Amount" class="oe_inline" readonly="True"
                                    force_save="1"/>
                                    = Requested Amount
                                     <field name="requested_amount" string="Requested Amount" class="oe_inline" readonly="state in ['transfered','paid','done','rejected']"/>
                                    )
                                    </div>
                                </group>

                            <div class="oe_clear"/>
                                <field name="loan_arc_ids" readonly="1">
                                    <tree decoration-danger="state in ('suspend')" decoration-info="state == 'draft'"  decoration-success="state == 'done'" string="Installments">
                                        <field name="date"/>
                                        <field name="year"/>
                                        <field name="month"/>
                                        <field name="amount"/>
                                        <field name="payment_type" />
                                        <field name="state" />
                                    </tree>
                                </field>
                                <group>
                                <group class="oe_subtotal_footer oe_right" colspan="2" >
                                    <field name="loan_amount" />
                                    <field name="total_paid_amount" />
                                    <field name="remain_amount" class="oe_subtotal_footer_separator" />
                                    <field name="check_update" invisible="1"/>

                                </group>
                                <field name="note" nolabel="1"/>
                                </group>

                            </page>
                            <page string="Direct Payment">
                                <field name="direct_payment_ids" readonly="1"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_loan_request_search_form" model="ir.ui.view">
            <field name="name">hr.loan.search.form</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
               <search string="Loans Requests">
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="loan_id"/>
                    <group expand="0" string="Group By">
                        <filter string="Employee" name="employee_id" context="{'group_by':'employee_id'}"/>
                        <filter string="Department" name="department_id" context="{'group_by':'department_id'}"/>
                        <filter string="Loan Type" name="loan_id" context="{'group_by':'loan_id'}"/>
                        <filter string="My Loans" name="my_requests" 
                        domain="[('employee_id.user_id', '=', uid)]"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_app_script_hr_loan_request" model="ir.actions.act_window">
            <field name="name">Loans Requests</field>
            <field name="res_model">hr.loan</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_loan_request_search_form"/>
        </record>

        <menuitem
            id="menu_app_script_hr_loan_request_action"
            action="action_app_script_hr_loan_request"
            parent="menu_app_script_hr_loan_root"
            sequence="1"
            groups="app_script_hr_loan.group_loan_read,app_script_hr_loan.group_loan_request"/>

        <record model="ir.ui.view" id="app_script_hr_loan_archive_form_view">
            <field name="name">hr.loan.archive.form</field>
            <field name="model">hr.loan.archive</field>
            <field name="arch" type="xml">
                <form string="Loans Archive">
                    <header>
                        <field name="state" widget="statusbar"  statusbar_visible="draft,paid" />
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="employee_id" required='1' readonly="1" force_save="1"/>
                                <field name="loan_id" required="1" readonly="1" force_save="1"/>
                                <field name="month" required="1" readonly="1" force_save="1"/>
                            </group>
                            <group>
                                <field name="company_id" readonly="1" force_save="1"/>
                                <field name="amount" readonly="1" force_save="1"/>
                                <field name="year" required="1" readonly="1" force_save="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="app_script_hr_loan_archive_tree_view" model="ir.ui.view" >
            <field name="name">hr.loan.archive.tree</field>
            <field name="model">hr.loan.archive</field>
            <field name="arch" type="xml">
                <tree string="Loans Archive" decoration-danger="state in ('suspend')" decoration-info="state == 'draft'" decoration-success="state == 'done'">
                    <field name="employee_id"/>
                    <field name="loan_type_id" />
                    <field name="month"/>
                    <field name="year"/>
                    <field name="amount" sum="amount"/>
                    <field name="payment_type" />
                    <field name="state" />
                </tree>
            </field>
        </record>

        <record id="view_loan_archive_search" model="ir.ui.view">
            <field name="name">hr.loan.archive.search</field>
            <field name="model">hr.loan.archive</field>
            <field name="arch" type="xml">
                <search string="Loans Archive">
                    <group expand="0" string="Group By...">
                        <filter string="Year" name="year" domain="[]" context="{'group_by':'year'}"/>
                        <filter string="Month" name="month" domain="[]" context="{'group_by':'month'}"/>
                        <filter string="Loan Type" name="loan_type_id" domain="[]" context="{'group_by':'loan_type_id'}"/>
                        <filter string="Employee" name="employee_id" domain="[]" context="{'group_by':'employee_id'}"/>
                        <filter string="Payment Type" name="payment_type" domain="[]" context="{'group_by':'payment_type'}"/>
                        <filter string="State" name="state" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="app_script_hr_loan_archive_tree" model="ir.actions.act_window">
    		<field name="name">Loans Archive</field>
    		<field name="res_model">hr.loan.archive</field>
    		<field name="view_mode">tree,form</field>
            <field name="context">{'create':False,'edit':False}</field>
    		<field name="view_id" ref="app_script_hr_loan_archive_tree_view"/>
	    </record>

        <menuitem
            id="menu_app_script_hr_loan_archive"
            parent="menu_app_script_hr_loan_root"
            action="app_script_hr_loan_archive_tree"
            sequence="50"
            groups="app_script_hr_loan.group_loan_read,app_script_hr_loan.group_loan_archive"/>

	 	<record model="ir.ui.view" id="app_script_hr_loan_suspend_form_view">
	        <field name="name">hr.loan.suspend.form</field>
	        <field name="model">hr.loan.suspend</field>
	        <field name="type">form</field>
	        <field name="arch" type="xml">
            	<form string="Loans Suspend">
                	<header>
	                    <button string="Request" name="action_request" states="draft" class="oe_highlight" type='object' groups="app_script_hr_loan.group_request_loan_suspend"/>
	                    <button string="Approve" name="action_approve" states="requested" class="oe_highlight" type="object" groups="app_script_hr_loan.group_approve_loan_suspend"/>
	                    <button string="Reject" name="action_reject" states="requested" type="object" groups="app_script_hr_loan.group_reject_loan_suspend"/>
	                    <button string="Set to Draft" name="action_draft" states="rejected" type="object" groups="app_script_hr_loan.group_set_to_draft_loan_suspend"/>
	                    <field name="state" widget="statusbar" statusbar_visible="draft,requested,approved" />
                	</header>
                	<sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="employee_id"/>
                                <field name="loan_id" domain="[('state','=','paid'),('employee_id','=',employee_id)]"/>
                            </group>
                            <group string="Loan Suspend Configration">
                                <field name="times_stop_loan"/>
                                <field name="period_stop_loan"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Installments">
                                <field name="arc_ids" domain="[('loan_id','=',loan_id),('state','=','paid')]"/>

                            </page>
                            <page string="Notes">
                               <field name="note"/>
                            </page>
                        </notebook>
                   </sheet>
                   <div class="oe_chatter">
                      <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                      <field name="message_ids" widget="mail_thread"/>
                  </div>
                </form>
            </field>
        </record>

	 	<record model="ir.ui.view" id="app_script_hr_loan_suspend_tree_view">
	        <field name="name">hr.loan.suspend.form</field>
	        <field name="model">hr.loan.suspend</field>
	        <field name="type">tree</field>
	        <field name="arch" type="xml">
	        	<tree string="Loans Suspend" decoration-info="state == 'draft'" decoration-muted="state == 'approved'">
                    <field name="name"/>
	        		<field name="employee_id"/>
	        		<field name="loan_id"/>
	        		<field name="state" />
	        	</tree>
	        </field>
	    </record>

	    <record id="app_script_hr_loan_suspend_search_view" model="ir.ui.view">
	    	<field name="name">hr.loan.suspend.search</field>
	    	<field name="model">hr.loan.suspend</field>
	    	<field name="arch" type="xml">
	    		<search>

	    			<filter string="State" name="group_by_state" context="{'group_by':'state'}"/>
	    		</search>
	    	</field>
	    </record>

        <record id="app_script_hr_loan_suspend_action" model="ir.actions.act_window">
			<field name="name">Loans Suspend</field>
			<field name="res_model">hr.loan.suspend</field>
			<field name="view_mode">tree,form</field>
			<field name="context">{}</field>
			<field name="view_id" ref="app_script_hr_loan_suspend_tree_view"/>
	    </record>

        <menuitem
            id="app_script_hr_loan_suspend_menu"
            action="app_script_hr_loan_suspend_action"
            parent="menu_app_script_hr_loan_root"
            sequence="2"
            groups="app_script_hr_loan.group_loan_read,app_script_hr_loan.group_loan_suspended_request"/>

        <record id="open_loan_modules" model="ir.actions.act_window">
            <field name="name">HR Loan</field>
            <field name="res_model">ir.module.module</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context" eval="{'search_default_name': 'HR Loan'}"/>
            <field name="search_view_id" ref="base.view_module_filter"/>
        </record>

        <record id="res_config_settings_view_form" model="ir.ui.view">
            <field name="name">res.config.settings.view.form.inherit.hr.loan.type</field>
            <field name="model">res.config.settings</field>
            <field name="priority" eval="50"/>
            <field name="inherit_id" ref="hr_payroll.res_config_settings_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@id='hr_payroll_localization']" position="after">
                    <div class="row mt16 o_settings_container" id="app_script_hr_loan_localization" >
                        <div class="col-md-6 col-xs-12 o_setting_box">
                            <group>
                                <field name="max_department" />
                            </group>
                        </div>
                    </div>
                    <div class="row mt16 o_settings_container" id="app_script_hr_loan_localization" >
                        <div class="col-md-6 col-xs-12 o_setting_box">
                            <group>
                                <field name="max_employee" />
                            </group>
                        </div>
                    </div>
                </xpath>
            </field>
        </record>

        <record id="action_app_script_hr_loan_configuration" model="ir.actions.act_window">
            <field name="name">Settings</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.config.settings</field>
            <field name="view_mode">form</field>
            <field name="target">inline</field>
            <field name="context">{'module' : 'app_script_hr_loan'}</field>
        </record>

        <menuitem id="menu_app_script_hr_loan_global_settings" name="Settings"
        parent="app_script_hr_loan.menu_app_script_hr_loan_configration" sequence="0" action="action_app_script_hr_loan_configuration"/>

</odoo>
